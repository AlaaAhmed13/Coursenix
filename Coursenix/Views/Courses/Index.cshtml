@* Views/Courses/Index.cshtml *@
@model Coursenix.ViewModels.CourseListViewModel

@{
    ViewData["Title"] = "Courses"; 
}
@section css {
    <link rel="stylesheet" href="@Url.Content("~/CSS/courses.css")">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
}


<nav class="navbar navbar-expand-lg navbar-light bg-white py-3">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <div class="logo">
                <img src="~/assets/logo.svg" alt="">
            </div>
            <div>
                <span class="word">Coursenix</span>
            </div>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a href="@Url.Action("Index", "Home")" class="nav-link">Home</a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "Courses")" class="nav-link active">Courses</a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "Home")" class="nav-link">Contact</a>
                </li>
                <li class="nav-item">
                    <a href="@Url.Action("Index", "Home")" class="nav-link">About</a>
                </li>
            </ul>
        </div>
    </div>
</nav>



<section class="hero-section">
    <div class="container">
        <h1>Let's Start Your Journey</h1>
        <p class="mb-0">Explore and book courses online with our easy-to-use platform</p>
    </div>
</section>
<div class="container py-4">
    <form asp-controller="Courses" asp-action="Index" method="get">
        <div class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="small mb-1" for="selectedSubject">Subject</label>
                <select class="form-select" id="selectedSubject" name="selectedSubject">
                    <option value="">All subjects</option>
                    @if (Model.AvailableSubjects != null)
                    {
                        @foreach (var subjectName in Model.AvailableSubjects)
                        {
                            <option value="@subjectName" selected="@(Model.SelectedSubject == subjectName)">@subjectName</option>
                        }
                    }
                </select>
            </div>
            <div class="col-md-4">
                <label class="small mb-1" for="selectedGrade">Grade</label>
                <select class="form-select" id="selectedGrade" name="selectedGrade">
                     <option value="">All Grades</option>
                     @if (Model.AvailableGrades != null)
                     {
                         @foreach (var grade in Model.AvailableGrades)
                         {
                             <option value="@grade" selected="@(Model.SelectedGrade == grade)">Grades @grade</option>
                         }
                     }
                </select>
            </div>
            <div class="col-md-4">
                 <label class="small mb-1" for="searchQuery">Teacher Name</label>
                <div class="search-box d-flex align-items-center"> 
                    <i class="fas fa-search me-2"></i> 
                    <input type="text" class="form-control search-input" id="searchQuery" name="searchQuery" placeholder="Search by teacher name" value="@Model.SearchQuery">
                </div>
            </div>
            <div class="col-auto">
                 <button type="submit" class="btn btn-primary">Apply Filters</button>
            </div>
        </div>
    </form>
</div>

<div class="container py-4">
    <div class="row g-4">
        @if (Model != null && Model.Courses != null && Model.Courses.Any())
        {
            @foreach (var course in Model.Courses)
            {
                <div class="col-lg-4 col-md-6">
                    <div class="course-card"> 
                        @if (!string.IsNullOrEmpty(course.ThumbnailFileName))
                        {
                            <img src="@Url.Content($"~/images/thumbnails/{course.ThumbnailFileName}")" alt="@course.SubjectName course" class="course-img">
                        }
                        else
                        {
                            <img src="@Url.Content("~/assets/course1.svg")" alt="@course.SubjectName course" class="course-img">
                        }

                        <div class="course-content"> 
                            <div class="p-one">
                                <h5 class="mb-0">@course.SubjectName</h5> 
                                <span class="course-price">@course.Price.ToString("C")</span> 
                            </div>
                            <p class="course-grade mb-2">Grade @course.GradeLevel</p> 
                            <p class="card-text">@course.Description</p> 
                            <div class="p-one"> 
                                <div class="teacher-info"> 
                                    <div class="teacher-avatar"> 
                                         @if (!string.IsNullOrEmpty(course.Teacher?.ProfilePicture))
                                         {
                                             <img src="@Url.Content($"~/images/teachers/{course.Teacher.ProfilePicture}")" alt="@(course.Teacher?.Name)" />
                                         }
                                         else
                                         {
                                             <img src="@Url.Content("~/assets/teacher1.svg")" alt="@(course.Teacher?.Name)" /> 
                                         }
                                    </div>
                                    <div>
                                        <div class="teacher-name">@(course.Teacher != null ? $"{course.Teacher.Name}" : "N/A")</div> 
                                    </div>
                                </div>



                                <button class="enroll-btn">
                                    <a asp-controller="Courses" asp-action="Details" asp-route-id="@course.Id">Enroll Now</a>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                }
            }
            else
            {
                <div class="col-12">
                    <p>No courses found matching your criteria.</p>
                </div>
            }

        </div>

    </div>

    <div class="pagination-container">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span>&laquo;</span>
                    </a>
                </li>
                <li class="page-item"><a class="page-link active" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                        <span>&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>



<!-- Footer -->
<footer id="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-4  mb-4 mb-lg-0 media">
                <div class="footer-logo">coursenix</div>
                <p class="footer-text">Simplifying the way students find courses and teachers manage classes.</p>
            </div>
            <div class="col-lg-4 mb-4 mb-lg-0 media two">
                <h5 class="mb-3 follow">Follow Us</h5>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"> </i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                </div>
            </div>
            <div class="col-lg-4 media">
                <h5 class="mb-3">Contact us</h5>
                <p class="footer-text">Phone number: +20 1549726354<br>Email: Dresley@gmail.com</p>
            </div>
        </div>
        <hr>
    </div>
    <div class="footer-bottom mt-4">
        <div class="container">
            <p>© 2024 coursenix. All Rights reserved</p>
        </div>
    </div>
</footer>



@section Scripts {
    
     <script>
        function debounce(func, delay) {
            let timer;
            return function() {
                const context = this;
                const args = arguments;
                clearTimeout(timer);
                timer = setTimeout(() => {
                    func.apply(context, args);
                }, delay);
            };
        }

        document.addEventListener('DOMContentLoaded', function () {
            const filterForm = document.querySelector('form[asp-controller="Courses"][asp-action="Index"][method="get"]');

            if (!filterForm) {
                console.warn("Filter form not found in the DOM.");
                return; 
            }

            const selects = filterForm.querySelectorAll('select');
            const searchInput = filterForm.querySelector('input[name="searchQuery"]');
            const applyButton = filterForm.querySelector('button[type="submit"]');
            const applyFilters = () => {
                 filterForm.submit();

            };

            selects.forEach(select => {
                select.addEventListener('change', applyFilters);
            });

            searchInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); 
                    applyFilters();
                }
            });

             searchInput.addEventListener('input', debounce(applyFilters, 500));

             if (applyButton) {
                 applyButton.style.display = 'none';
             }
        });
    </script>



}
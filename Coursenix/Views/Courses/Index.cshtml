@* Views/Courses/Index.cshtml *@
@model Coursenix.Models.ViewModels.CourseListViewModel

@{
    ViewData["Title"] = "Courses"; 


}
@section css {
    <link rel="stylesheet" href="@Url.Content("~/CSS/courses.css")">
}

<section class="hero-section">
    <div class="container">
        <h1>Let's Start Your Journey</h1>
        <p class="mb-0">Explore and book courses online with our easy-to-use platform</p>
    </div>
</section>
<div class="container py-4">
    <form asp-controller="Courses" asp-action="Index" method="get">
        <div class="row g-3 align-items-end">
            <div class="col-md-4">
                <label class="small mb-1" for="selectedSubject">Subject</label>
                <select class="form-select" id="selectedSubject" name="selectedSubject">
                    <option value="">All subjects</option>
                    @if (Model.AvailableSubjects != null)
                    {
                        @foreach (var subjectName in Model.AvailableSubjects)
                        {
                            <option value="@subjectName" selected="@(Model.SelectedSubject == subjectName)">@subjectName</option>
                        }
                    }
                </select>
            </div>
            <div class="col-md-4">
                <label class="small mb-1" for="selectedGrade">Grade</label>
                <select class="form-select" id="selectedGrade" name="selectedGrade">
                     <option value="">All Grades</option>
                     @if (Model.AvailableGrades != null)
                     {
                         @foreach (var grade in Model.AvailableGrades)
                         {
                             <option value="@grade" selected="@(Model.SelectedGrade == grade)">Grades @grade</option>
                         }
                     }
                </select>
            </div>
            <div class="col-md-4">
                 <label class="small mb-1" for="searchQuery">Teacher Name</label>
                <div class="search-box d-flex align-items-center"> 
                    <i class="fas fa-search me-2"></i> 
                    <input type="text" class="form-control search-input" id="searchQuery" name="searchQuery" placeholder="Search by teacher name" value="@Model.SearchQuery">
                </div>
            </div>
            <div class="col-auto">
                 <button type="submit" class="btn btn-primary">Apply Filters</button>
            </div>
        </div>
    </form>
</div>

<div class="container py-4">
    <div class="row g-4">
        @if (Model != null && Model.Courses != null && Model.Courses.Any())
        {
            @foreach (var course in Model.Courses)
            {
                <div class="col-lg-4 col-md-6">
                    <div class="course-card"> 
                        @if (!string.IsNullOrEmpty(course.ThumbnailFileName))
                        {
                            <img src="@Url.Content($"~/images/thumbnails/{course.ThumbnailFileName}")" alt="@course.SubjectName course" class="course-img">
                        }
                        else
                        {
                            <img src="@Url.Content("~/assets/course1.svg")" alt="@course.SubjectName course" class="course-img">
                        }

                        <div class="course-content"> 
                            <div class="p-one">
                                <h5 class="mb-0">@course.SubjectName</h5> 
                                <span class="course-price">@course.Price.ToString("C")</span> 
                            </div>
                            <p class="course-grade mb-2">Grade @course.GradeLevel</p> 
                            <p class="card-text">@course.Description</p> 
                            <div class="p-one"> 
                                <div class="teacher-info"> 
                                    <div class="teacher-avatar"> 
                                         @if (!string.IsNullOrEmpty(course.Teacher?.ProfilePicture))
                                         {
                                             <img src="@Url.Content($"~/images/teachers/{course.Teacher.ProfilePicture}")" alt="@(course.Teacher?.FirstName)" />
                                         }
                                         else
                                         {
                                             <img src="@Url.Content("~/assets/teacher1.svg")" alt="@(course.Teacher?.FirstName)" /> @* صورة افتراضية *@
                                         }
                                    </div>
                                    <div>
                                        <div class="teacher-name">@(course.Teacher != null ? $"{course.Teacher.FirstName} {course.Teacher.LastName}" : "N/A")</div> @* يستخدم class="teacher-name" للتصميم *@
                                    </div>
                                </div>



                                <button class="enroll-btn">
                                    <a asp-controller="Courses" asp-action="Details" asp-route-id="@course.SubjectId">Enroll Now</a>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                }
            }
            else
            {
                <div class="col-12">
                    <p>No courses found matching your criteria.</p>
                </div>
            }


        </div>

    </div>

    <div class="pagination-container">
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Previous">
                        <span>&laquo;</span>
                    </a>
                </li>
                <li class="page-item"><a class="page-link active" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#" aria-label="Next">
                        <span>&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

@section Scripts {
    
     <script>
        function debounce(func, delay) {
            let timer;
            return function() {
                const context = this;
                const args = arguments;
                clearTimeout(timer);
                timer = setTimeout(() => {
                    func.apply(context, args);
                }, delay);
            };
        }

        document.addEventListener('DOMContentLoaded', function () {
            const filterForm = document.querySelector('form[asp-controller="Courses"][asp-action="Index"][method="get"]');

            if (!filterForm) {
                console.warn("Filter form not found in the DOM.");
                return; 
            }

            const selects = filterForm.querySelectorAll('select');
            const searchInput = filterForm.querySelector('input[name="searchQuery"]');
            const applyButton = filterForm.querySelector('button[type="submit"]');


            // دالة لإرسال النموذج (تطبيق الفلاتر)
            const applyFilters = () => {
                 // فقط أرسل النموذج إذا كنا نعتمد على JavaScript لتطبيق الفلاتر تلقائياً
                 // (أي إذا كان زر "Apply Filters" مخفياً أو غير مستخدم للإرسال اليدوي)
                 // أو إذا كنا نريد دائماً إرسال النموذج عند تغيير الفلاتر أو البحث
                 filterForm.submit();

                 // إذا كنت تفضل الإرسال فقط عند الضغط على الزر، علق السطر أعلاه
                 // وقم بإزالة أو تعليق الكود الذي يخفي الزر في الأسفل
            };

            // تطبيق الفلاتر عند تغيير اختيار الموضوع أو الصف الدراسي
            selects.forEach(select => {
                select.addEventListener('change', applyFilters);
            });

            // تطبيق الفلاتر عند الضغط على Enter في حقل البحث
            searchInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // منع الإرسال الافتراضي للنموذج عن طريق Enter
                    applyFilters();
                }
            });

             // تطبيق الفلاتر بعد فترة قصيرة من التوقف عن الكتابة في حقل البحث (بحث لحظي)
             // تأكد أن دالة debounce معرفة (كما هي أعلاه)
             // uncomment the line below if you want live search
             searchInput.addEventListener('input', debounce(applyFilters, 500));


             // خيار: إخفاء زر "Apply Filters" إذا كنت تريد JavaScript لتطبيق الفلاتر تلقائياً
             // علّق هذا القسم إذا كنت تريد أن يبقى الزر مرئياً ويتم الإرسال بالضغط عليه يدوياً
             if (applyButton) {
                 applyButton.style.display = 'none';
             }


        });
    </script>



}
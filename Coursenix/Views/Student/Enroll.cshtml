@model EnrollViewModel
@{
    Layout = "_Layout";
}
@section css{
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dresley - Course Enrollment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/courseDetailsG7.css">
}
<body>
    @*ماا هذا*@
    @* <!-- User info --> *@
    @* <div class="d-flex align-items-center"> *@
    @*     <div class="user-avatar bg-teal text-white rounded-circle d-flex justify-content-center align-items-center" style="width: 35px; height: 35px; font-weight: bold;">M</div> *@
    @*     <span class="ms-2 user-name">Michael Johnson</span> *@
    @* </div> *@
    @* </div> *@
    <!-- Header Section with Teal Background -->
    <!-- Header Section -->
    <!-- Main Course Card -->

    <div class="course-card-wrapper">
        <div class="course-card">
            <div class="row align-items-center mb-4">
                <div class="col-md-8">
                    <h2>@Model.CourseName</h2>
                    <div class="course-info">
                        @* <span><i class="fas fa-graduation-cap"></i> Grades 7-9</span>*@
                        @* <span><i class="fas fa-calendar"></i> 2 Classes/Week</span> *@
                        <span><i class="fas fa-map-marker-alt"></i> @(string.IsNullOrEmpty(Model.Location) ? "" : Model.Location)</span>
                    </div>
                </div>
            </div>
            </div>

            <div class="teacher-info">
                <div class="teacher-image">
                    @Model.TeacherName
                    @* <img src=" ../assets/teacher1.svg" alt=""> *@
                </div>
                <div>
                    <h5 class="teacher-name">@Model.TeacherName</h5>
                    <p class="teacher-title">@(string.IsNullOrEmpty(Model.Description) ? "" : Model.Description)</p>
                </div>
            </div>

            <hr>

            <h4 class="mb-3">Choose your Grade</h4>
            <div class="grade-tabs mb-4">
                @foreach (var grade in Model.GradeLevels)
                {
                    <div class="grade-tab" data-grade-id="@grade.GradeLevelId">
                        Grade @grade.NumberOfGrade
                    </div>
                }
            </div>

                <p class="mb-4">Select one of the available groups below to enroll in this course.</p>

    <div id="groups-container">
        @foreach (var grade in Model.GradeLevels)
        {
            <div class="grade-groups" data-grade-id="@grade.GradeLevelId" style="display: none;">
                @foreach (var group in grade.Groups)
                {
                    <div class="group-card mb-3" data-group-id="@group.GroupId">
                        <h5 class="group-title">@group.Name</h5>
                        <ul class="group-details">
                            <li>@string.Join(", ", group.SelectedDays)</li>
                                <li>
                                    @group.StartTime.ToString("HH:mm") - @group.EndTime.ToString("HH:mm")
                                </li>
                        </ul>

                        @{
                            var availableSeats = group.TotalSeats - group.EnrolledStudentsCount;
                        }
                        <span class="seats-badge @(availableSeats > 0 ? "seats-available" : "seats-unavailable")">
                            @(availableSeats > 0 ? $"{availableSeats} seats available" : "Not Available")
                        </span>

                        @if (availableSeats > 0)
                        {
                            <div class="radio-button"></div>
                        }
                    </div>
                }
            </div>
        }
    </div>

    <form method="post" asp-controller="Student" asp-action="Enroll" id="enroll-form">
        <input type="hidden" name="groupId" id="selectedGroupId" />
        <div class="mt-4 text-end">
            <button type="submit" class="btn btn-primary enroll-btn">Enroll</button>
        </div>
    </form>
</div>
</body>
@section Scripts {
    <script>
        $(document).ready(function () {
            // تفعيل أول Grade Tab افتراضياً
            $('.grade-tab').first().addClass('active');
            var firstGradeId = $('.grade-tab').first().data('grade-id');
            $('.grade-groups[data-grade-id="' + firstGradeId + '"]').show();

            // عند الضغط على Grade Tab
            $('.grade-tab').click(function () {
                $('.grade-tab').removeClass('active');
                $(this).addClass('active');

                var gradeId = $(this).data('grade-id');
                $('.grade-groups').hide();
                $('.grade-groups[data-grade-id="' + gradeId + '"]').show();

                // Reset selected group
                $('#selectedGroupId').val('');
                $('.group-card').removeClass('selected');
            });

            // اختيار الجروب (radio-style)
            $(document).on('click', '.group-card', function () {
                if ($(this).find('.seats-badge').hasClass('seats-available')) {
                    $('.group-card').removeClass('selected');
                    $(this).addClass('selected');

                    var selectedGroupId = $(this).data('group-id');
                    $('#selectedGroupId').val(selectedGroupId);
                }
            });

            // منع الفورم من الإرسال لو مفيش جروب متحدد
            $('#enroll-form').submit(function (e) {
                if (!$('#selectedGroupId').val()) {
                    e.preventDefault();
                    alert('Please select a group first!');
                }
            });
        });
    </script>
    }